version: '3.8'

services:
{{range .Services}}
  {{.Name}}:
    image: {{.Image}}
    ports:
      - "{{.Port}}:{{.Port}}"
    environment:
{{range $key, $value := .Environment}}
      - {{$key}}={{$value}}
{{end}}
    volumes:
{{range .Volumes}}
      - {{.}}
{{end}}
      # Mount secrets from env directory
      - ./env:/run/secrets:ro
    secrets:
{{range .Secrets}}
      - {{.}}
{{end}}
    networks:
      - portico-network
{{if .DependsOn}}
    depends_on:
{{range .DependsOn}}
      - {{.}}
{{end}}
{{end}}
{{end}}

networks:
  portico-network:
    external: true

secrets:
{{range .Secrets}}
  {{.}}:
    file: ./env/{{.}}
{{end}}
