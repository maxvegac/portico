# Portico Docker Compose Configuration
# Auto-generated by Portico

name: {{.AppName}}

services:
{{range .Services}}
  {{.Name}}:
    image: {{.Image}}
{{- if .Ports}}
    ports:
{{- range .Ports}}
      - "{{.}}"
{{- end}}
{{- end}}
{{- if .Environment}}
    environment:
{{- range $key, $value := .Environment}}
      - {{$key}}={{$value}}
{{- end}}
{{- end}}
    volumes:
{{- if .Volumes}}
{{- range .Volumes}}
      - {{.}}
{{- end}}
{{- end}}
      # Mount logs directory for application logs (if app writes to /app/logs or similar)
      # Docker container logs (stdout/stderr) are still in /var/lib/docker/containers/
      # To access container logs: docker logs <container-name>
      - /home/portico/logs/apps/{{$.AppName}}/{{.Name}}:/app/logs:rw
{{- if .Secrets}}
    secrets:
{{- range .Secrets}}
      - {{.}}
{{- end}}
{{- end}}
{{- if .DependsOn}}
    depends_on:
{{- range .DependsOn}}
      - {{.}}
{{- end}}
{{- end}}
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
        tag: "{{$.AppName}}-{{.Name}}"
    networks:
      - portico-network
{{end}}

networks:
  portico-network:
    external: true
{{- if .Secrets}}

secrets:
{{- range $name, $config := .Secrets}}
  {{$name}}:
    file: {{$config.File}}
{{- end}}
{{- end}}
{{- if .XPortico}}

x-portico:
  domain: {{.XPortico.Domain}}
{{- if .XPortico.HttpEnabled}}
  http_enabled: true
  http_port: {{.XPortico.Port}}
{{- else}}
  http_enabled: false
{{- end}}
{{- if .XPortico.Generated}}
  generated_hash: {{.XPortico.Generated}}
{{- end}}
{{- end}}
